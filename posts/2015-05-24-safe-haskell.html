<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Safe Haskell</title>
    <link rel="stylesheet" type="text/css" href="../css/bootstrap-readable.min.css" />
    <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/default.css" />
    <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
    <link rel="stylesheet" type="text/css" href="../css/minimalist.css" />

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
  </head>
  <body>
    <div class="container">
      <div class="header row">
        <h3><a class="text-muted col-sm-8" href="../">begriffs</a></h3>

        <ul class="col-sm-4 list-inline">
          <li><a class="text-muted" href="../about.html"><i class="fa fa-info-circle"></i></a></li>
          <li><a class="text-muted" href="http://github.com/begriffs"><i class="fa fa-github"></i></a></li>
          <li><a class="text-muted" href="http://twitter.com/begriffs"><i class="fa fa-twitter"></i></a></li>
          <li><a class="text-muted" href="../atom.xml"><i class="fa fa-rss"></i></a></li>
        </ul>
      </div>

      <div class="post-header">
  <h3>Safe Haskell</h3>
  <a href="https://twitter.com/share" class="twitter-share-button pull-right" data-via="begriffs" data-count="none">Tweet</a>
  <h5 class="text-muted">May 24, 2015</h5>
</div>

<div class="content">
  <p>Kristen Kozak explains how the Safe Haskell language extension can be used to deal with untrusted code. She shows how certain Haskell language features create security loopholes and why Safe Haskell disallows them. The safe subset is not enabled by default but you can (and should) enable it with <code>{-# LANGUAGE Safe #-}</code> whenever possible.</p>
<div class="flowplayer" data-embed="false">
<p><video type="video/mp4" src="http://player.vimeo.com/external/128024210.hd.mp4?s=edb4c23d14c4f532c26c37da58e0f446" poster="https://i.vimeocdn.com/video/519026893.jpg?mw=700"></video></p>
</div>
<h3 id="summary">Summary</h3>
<ul>
<li>Safe Haskell has been around since ghc 7.2</li>
<li>It supports custom security policies for running untrusted code and was designed to be unobtrusive</li>
<li>Great for environments like tryhaskell.org that accepts wild user input</li>
<li>Another source of safety is using <a href="https://hackage.haskell.org/package/lio">labeled IO</a> which binds labels to data for tracking provenance and restricting disclosure</li>
<li>Safe Haskell also helps developers audit their libraries because GHC enforces levels of safety (more on this later)</li>
<li>Using Safe Haskell improves code style because it forces you to separate the safe and unsafe parts of your modules</li>
<li>What is “safety” then?
<ul>
<li>First that the types can always be trusted. For instance that pure functions cannot perform IO. UnsafePerformIO is prohibited to them.</li>
<li>Next that the encapsulation of modules is enforced. No template haskell tricks, for instance, which could get access to private parts of other modules</li>
</ul></li>
<li>Isn’t this how Haskell already works? Not exactly, there are loopholes which safe haskell closes
<ul>
<li>SH is a language subset of Haskell</li>
<li>Adds rules around module imports</li>
<li>Defines a trust systems for entire packages</li>
</ul></li>
<li>SH trust is defined on entire modules, and each module can be one of
<ul>
<li>Safe (written in the safe language, with safe or trusted imports)</li>
<li>Trustworthy (marked as such by user)</li>
<li>Unsafe (the usual)</li>
</ul></li>
<li>Properties of the safe language itself
<ul>
<li>Type safety</li>
<li>Referential transparency</li>
<li>Module encapsulation</li>
<li>Modular reasoning</li>
<li>Semantic consistency (code doesn’t change meaning just because safety is enabled)</li>
</ul></li>
<li>The safe language disallows some language extensions and restricts others</li>
<li>Limitations
<ul>
<li>Does not address resources limits or compilation safety</li>
<li>Use something like a virtual machine for that</li>
<li>Relies on library authors to do the separation in their modules into safe and unsafe parts</li>
<li>For instance the vector package has not yet been separated</li>
</ul></li>
<li>If you’re going to use safe haskell it’s important to enable the package trust system by setting the flag <code>-fpackage-trust</code>.</li>
<li>Q&amp;A</li>
</ul>
</div>

    </div>

    <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="../js/flowplayer.min.js"></script>
    <!-- Aww yiss, obsessively watching my numbers! -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-49573102-1', 'begriffs.com');
      ga('send', 'pageview');
    </script>

    <footer class="container">
      <p>I'm begriffs, journeying from web ephemera to the timeless world of data. <a href="mailto:joe@begriffs.com" role="button">Contact me.</a></p>
    </footer>
  </body>
</html>
