<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Honest Code</title>
    <link rel="stylesheet" type="text/css" href="../css/bootstrap-readable.min.css" />
    <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/default.css" />
    <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
    <link rel="stylesheet" type="text/css" href="../css/minimalist.css" />

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
  </head>
  <body>
    <div class="container">
      <div class="header row">
        <h3><a class="text-muted col-sm-8" href="../">begriffs</a></h3>

        <ul class="col-sm-4 list-inline">
          <li><a class="text-muted" href="../about.html"><i class="fa fa-info-circle"></i></a></li>
          <li><a class="text-muted" href="http://github.com/begriffs"><i class="fa fa-github"></i></a></li>
          <li><a class="text-muted" href="http://twitter.com/begriffs"><i class="fa fa-twitter"></i></a></li>
          <li><a class="text-muted" href="../atom.xml"><i class="fa fa-rss"></i></a></li>
        </ul>
      </div>

      <div class="post-header">
  <h3>Honest Code</h3>
  <a href="https://twitter.com/share" class="twitter-share-button pull-right" data-via="begriffs" data-count="none">Tweet</a>
  <h5 class="text-muted">November 11, 2011</h5>
</div>

<div class="content">
  <p>This post is about sucking it up and just writing low-level code. Over the past few months I have visited and revisited ideas for interpreting <a href="http://en.wikipedia.org/wiki/Combinatory_logic">combinatory logic</a> which is a functional language with just three single-letter building blocks. The vision was to create a database which <a href="http://en.wikipedia.org/wiki/Memoize">memoizes</a> all combinatory logic reductions for good. An ever-growing central repository for all computable knowledge. Any purely functional program could be compiled into combinatory logic and checked against the database to see if it had alredy been run – or if parts of it had.</p>
<p>My <a href="https://github.com/begriffs/clache/tree/feature/php">first attempt</a> was a web app in PHP with a Postgres back end. The term to be reduced was passed as a url (or post variable for larger terms), and the server replied with either a <a href="http://bit.ly/syy6dB">normal form</a> or a timeout.</p>
<p>The algorithm used some intensive <a href="http://code.google.com/p/clache/wiki/ReductionStrategy">back and forth</a> with the database, and started off running very slowly. As it processed more terms, it sped up because subterms were cached in the database. However, as the database grew (to several gigabytes), the algorithm hit a performance wall.</p>
<p>My <a href="https://github.com/begriffs/clache">next attempt</a> was to write an app for Google’s App Engine. After all, reducing CL terms can be done in parallel just fine, there is no mutable data involved. I used a simpler algorithm with the database. Rather than storing intermediate steps, I stored just successful reductions to normal form. I then generated all CL terms of length 17, and tried reducing them all, ten at a time concurrently. The app engine worked flawlessly, no slowdown. However, when I tried reducing very large CL terms compiled from Scheme, the app engine’s computation time limit prevented the reduction from ever finishing. No amount of preliminary steps could soften the problem and get past the time limit. This app would be very promising if I could somehow lift the limit.</p>
<p>Today I decided to trash the frills and see how well a bare metal C implementation would stack up. Lots of pointer arithmetic and a few memcpy’s later, and the <a href="https://github.com/begriffs/clache/tree/feature/c">beast</a> was ready. The result? At under 100 loc and avoiding all clever database tricks, it was super fast, much faster than the tricky ones. Kind of embarassing to tell the truth. Now perhaps the app engine version would scale to leverage existing computations in its cache, but maybe not.</p>
<p>Sometimes the best code is just dumb simple. Long live C.</p>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'begriffs';

  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

    </div>

    <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="../js/flowplayer.min.js"></script>
    <!-- Aww yiss, obsessively watching my numbers! -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-49573102-1', 'begriffs.com');
      ga('send', 'pageview');
    </script>

    <footer class="container">
      <p>I'm begriffs, journeying from web ephemera to the timeless world of data. <a href="mailto:joe@begriffs.com" role="button">Contact me.</a></p>
    </footer>
  </body>
</html>
